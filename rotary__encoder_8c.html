<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>esp32-rotary-encoder: /home/travis/build/DavidAntliff/esp32-rotary-encoder/rotary_encoder.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">esp32-rotary-encoder
   </div>
   <div id="projectbrief">ESP32-compatible C library for Incremental Rotary Encoders.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">/home/travis/build/DavidAntliff/esp32-rotary-encoder/rotary_encoder.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Driver implementation for the ESP32-compatible Incremental Rotary Encoder component.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rotary__encoder_8h_source.html">rotary_encoder.h</a>&quot;</code><br/>
<code>#include &quot;esp_log.h&quot;</code><br/>
<code>#include &quot;driver/gpio.h&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afc3d101f633a076cc1ca84b85b6224b2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc3d101f633a076cc1ca84b85b6224b2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TAG</b>&#160;&#160;&#160;&quot;rotary_encoder&quot;</td></tr>
<tr class="separator:afc3d101f633a076cc1ca84b85b6224b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07ff18b64a31c53c59a30fd635c22bbb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a07ff18b64a31c53c59a30fd635c22bbb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EVENT_QUEUE_LENGTH</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a07ff18b64a31c53c59a30fd635c22bbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dcd1ac562a65501bf6436324a8bf506"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8dcd1ac562a65501bf6436324a8bf506"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TABLE_ROWS</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:a8dcd1ac562a65501bf6436324a8bf506"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a665390e734d124195aa8d263d475c73a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a665390e734d124195aa8d263d475c73a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIR_NONE</b>&#160;&#160;&#160;0x0</td></tr>
<tr class="separator:a665390e734d124195aa8d263d475c73a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32aebb0062f8833d08b204b072721245"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a32aebb0062f8833d08b204b072721245"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIR_CW</b>&#160;&#160;&#160;0x10</td></tr>
<tr class="separator:a32aebb0062f8833d08b204b072721245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d4cfbbc36469e74e77804b0c3c9d0ba"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6d4cfbbc36469e74e77804b0c3c9d0ba"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIR_CCW</b>&#160;&#160;&#160;0x20</td></tr>
<tr class="separator:a6d4cfbbc36469e74e77804b0c3c9d0ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0faa76cd701de466ad702664b93d642"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa0faa76cd701de466ad702664b93d642"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>R_START</b>&#160;&#160;&#160;0x0</td></tr>
<tr class="separator:aa0faa76cd701de466ad702664b93d642"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82c89f78726d2f4ef38a96fdede6634f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a82c89f78726d2f4ef38a96fdede6634f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>H_CCW_BEGIN</b>&#160;&#160;&#160;0x1</td></tr>
<tr class="separator:a82c89f78726d2f4ef38a96fdede6634f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a474ae368773b6bfecd1d95d4a2dc97"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7a474ae368773b6bfecd1d95d4a2dc97"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>H_CW_BEGIN</b>&#160;&#160;&#160;0x2</td></tr>
<tr class="separator:a7a474ae368773b6bfecd1d95d4a2dc97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a1af27996f6c5cd4c37db52ea4f5080"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7a1af27996f6c5cd4c37db52ea4f5080"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>H_START_M</b>&#160;&#160;&#160;0x3</td></tr>
<tr class="separator:a7a1af27996f6c5cd4c37db52ea4f5080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada756d91a84f98244f79e28493fb88e4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ada756d91a84f98244f79e28493fb88e4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>H_CW_BEGIN_M</b>&#160;&#160;&#160;0x4</td></tr>
<tr class="separator:ada756d91a84f98244f79e28493fb88e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e5bd8983343c8a58a93db5d0f75bd16"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5e5bd8983343c8a58a93db5d0f75bd16"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>H_CCW_BEGIN_M</b>&#160;&#160;&#160;0x5</td></tr>
<tr class="separator:a5e5bd8983343c8a58a93db5d0f75bd16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a77f9e23eee2f9daf97bd9444aa6a35"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2a77f9e23eee2f9daf97bd9444aa6a35"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CW_FINAL</b>&#160;&#160;&#160;0x1</td></tr>
<tr class="separator:a2a77f9e23eee2f9daf97bd9444aa6a35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab378e77764bb6d5831ef9a727d33d465"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab378e77764bb6d5831ef9a727d33d465"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CW_BEGIN</b>&#160;&#160;&#160;0x2</td></tr>
<tr class="separator:ab378e77764bb6d5831ef9a727d33d465"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ddea044fd65ecdb0d0dfd14d5c306a7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ddea044fd65ecdb0d0dfd14d5c306a7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CW_NEXT</b>&#160;&#160;&#160;0x3</td></tr>
<tr class="separator:a1ddea044fd65ecdb0d0dfd14d5c306a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7a265984918b9f801458fd581899bfd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae7a265984918b9f801458fd581899bfd"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CCW_BEGIN</b>&#160;&#160;&#160;0x4</td></tr>
<tr class="separator:ae7a265984918b9f801458fd581899bfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada1fe43c9290b9cce7fa003a840f4d9f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ada1fe43c9290b9cce7fa003a840f4d9f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CCW_FINAL</b>&#160;&#160;&#160;0x5</td></tr>
<tr class="separator:ada1fe43c9290b9cce7fa003a840f4d9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa75657db9bd9a3ed1af94c0a7afa5c5f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa75657db9bd9a3ed1af94c0a7afa5c5f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>F_CCW_NEXT</b>&#160;&#160;&#160;0x6</td></tr>
<tr class="separator:aa75657db9bd9a3ed1af94c0a7afa5c5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1ab022382cc11d8c166530edd3c1b258"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#a1ab022382cc11d8c166530edd3c1b258">rotary_encoder_init</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info, gpio_num_t pin_a, gpio_num_t pin_b)</td></tr>
<tr class="memdesc:a1ab022382cc11d8c166530edd3c1b258"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called.  <a href="#a1ab022382cc11d8c166530edd3c1b258">More...</a><br/></td></tr>
<tr class="separator:a1ab022382cc11d8c166530edd3c1b258"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87cbd3ea0a9ad3294d33a3fb21000e58"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#a87cbd3ea0a9ad3294d33a3fb21000e58">rotary_encoder_enable_half_steps</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info, bool enable)</td></tr>
<tr class="memdesc:a87cbd3ea0a9ad3294d33a3fb21000e58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable half-stepping mode. This generates twice as many counted steps per rotation.  <a href="#a87cbd3ea0a9ad3294d33a3fb21000e58">More...</a><br/></td></tr>
<tr class="separator:a87cbd3ea0a9ad3294d33a3fb21000e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a845c5991d014cd4061f24b967c97c4b5"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#a845c5991d014cd4061f24b967c97c4b5">rotary_encoder_flip_direction</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info)</td></tr>
<tr class="memdesc:a845c5991d014cd4061f24b967c97c4b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reverse (flip) the sense of the direction. Use this if clockwise/counterclockwise are not what you expect.  <a href="#a845c5991d014cd4061f24b967c97c4b5">More...</a><br/></td></tr>
<tr class="separator:a845c5991d014cd4061f24b967c97c4b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa181030c3edeb8ea430dc366ee009e99"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#aa181030c3edeb8ea430dc366ee009e99">rotary_encoder_uninit</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info)</td></tr>
<tr class="memdesc:aa181030c3edeb8ea430dc366ee009e99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the interrupt handlers installed by <a class="el" href="rotary__encoder_8h.html#a1ab022382cc11d8c166530edd3c1b258" title="Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called. ">rotary_encoder_init</a>. Note: GPIOs will be left in the state they were configured by <a class="el" href="rotary__encoder_8h.html#a1ab022382cc11d8c166530edd3c1b258" title="Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called. ">rotary_encoder_init</a>.  <a href="#aa181030c3edeb8ea430dc366ee009e99">More...</a><br/></td></tr>
<tr class="separator:aa181030c3edeb8ea430dc366ee009e99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedafea81edf1547c3822bb3f6356159f"><td class="memItemLeft" align="right" valign="top">QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#aedafea81edf1547c3822bb3f6356159f">rotary_encoder_create_queue</a> (void)</td></tr>
<tr class="memdesc:aedafea81edf1547c3822bb3f6356159f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a queue handle suitable for use as an event queue.  <a href="#aedafea81edf1547c3822bb3f6356159f">More...</a><br/></td></tr>
<tr class="separator:aedafea81edf1547c3822bb3f6356159f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04b593e8b7464f56bb61f707ec5ea3c4"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#a04b593e8b7464f56bb61f707ec5ea3c4">rotary_encoder_set_queue</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info, QueueHandle_t queue)</td></tr>
<tr class="memdesc:a04b593e8b7464f56bb61f707ec5ea3c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the driver to use the specified queue as an event queue. It is recommended that a queue constructed by <a class="el" href="rotary__encoder_8h.html#aedafea81edf1547c3822bb3f6356159f" title="Create a queue handle suitable for use as an event queue. ">rotary_encoder_create_queue</a> is used.  <a href="#a04b593e8b7464f56bb61f707ec5ea3c4">More...</a><br/></td></tr>
<tr class="separator:a04b593e8b7464f56bb61f707ec5ea3c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f098676e06b1500fc64d391c7931cb0"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#a0f098676e06b1500fc64d391c7931cb0">rotary_encoder_get_state</a> (const <a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info, <a class="el" href="structrotary__encoder__state__t.html">rotary_encoder_state_t</a> *state)</td></tr>
<tr class="memdesc:a0f098676e06b1500fc64d391c7931cb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current position of the rotary encoder.  <a href="#a0f098676e06b1500fc64d391c7931cb0">More...</a><br/></td></tr>
<tr class="separator:a0f098676e06b1500fc64d391c7931cb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7bdc0adf57d3e83b9e1d2222186ebc2"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rotary__encoder_8c.html#ac7bdc0adf57d3e83b9e1d2222186ebc2">rotary_encoder_reset</a> (<a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *info)</td></tr>
<tr class="memdesc:ac7bdc0adf57d3e83b9e1d2222186ebc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the current position of the rotary encoder to zero.  <a href="#ac7bdc0adf57d3e83b9e1d2222186ebc2">More...</a><br/></td></tr>
<tr class="separator:ac7bdc0adf57d3e83b9e1d2222186ebc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Driver implementation for the ESP32-compatible Incremental Rotary Encoder component. </p>
<p>Based on <a href="https://github.com/buxtronix/arduino/tree/master/libraries/Rotary">https://github.com/buxtronix/arduino/tree/master/libraries/Rotary</a> Original header follows:</p>
<p>Rotary encoder handler for arduino. v1.1</p>
<p>Copyright 2011 Ben Buxton. Licenced under the GNU GPL Version 3. Contact: <a href="#" onclick="location.href='mai'+'lto:'+'bb@'+'ca'+'cti'+'i.'+'net'; return false;">bb@ca<span style="display: none;">.nosp@m.</span>ctii<span style="display: none;">.nosp@m.</span>.net</a></p>
<p>A typical mechanical rotary encoder emits a two bit gray code on 3 output pins. Every step in the output (often accompanied by a physical 'click') generates a specific sequence of output codes on the pins.</p>
<p>There are 3 pins used for the rotary encoding - one common and two 'bit' pins.</p>
<p>The following is the typical sequence of code on the output when moving from one step to the next:</p>
<h2>Position Bit1 Bit2 </h2>
<p>Step1 0 0 1/4 1 0 1/2 1 1 3/4 0 1 Step2 0 0</p>
<p>From this table, we can see that when moving from one 'click' to the next, there are 4 changes in the output code.</p>
<ul>
<li>From an initial 0 - 0, Bit1 goes high, Bit0 stays low.</li>
<li>Then both bits are high, halfway through the step.</li>
<li>Then Bit1 goes low, but Bit2 stays high.</li>
<li>Finally at the end of the step, both bits return to 0.</li>
</ul>
<p>Detecting the direction is easy - the table simply goes in the other direction (read up instead of down).</p>
<p>To decode this, we use a simple state machine. Every time the output code changes, it follows state, until finally a full steps worth of code is received (in the correct order). At the final 0-0, it returns a value indicating a step in one direction or the other.</p>
<p>It's also possible to use 'half-step' mode. This just emits an event at both the 0-0 and 1-1 positions. This might be useful for some encoders where you want to detect all positions.</p>
<p>If an invalid state happens (for example we go from '0-1' straight to '1-0'), the state machine resets to the start until 0-0 and the next valid codes occur.</p>
<p>The biggest advantage of using a state machine over other algorithms is that this has inherent debounce built in. Other algorithms emit spurious output with switch bounce, but this one will simply flip between sub-states until the bounce settles, then continue along the state machine. A side effect of debounce is that fast rotations can cause steps to be skipped. By not requiring debounce, fast rotations can be accurately measured. Another advantage is the ability to properly handle bad state, such as due to EMI, etc. It is also a lot simpler than others - a static state table and less than 10 lines of logic. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a1ab022382cc11d8c166530edd3c1b258"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gpio_num_t&#160;</td>
          <td class="paramname"><em>pin_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gpio_num_t&#160;</td>
          <td class="paramname"><em>pin_b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">info</td><td>Pointer to allocated rotary encoder info structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pin_a</td><td>GPIO number for rotary encoder output A. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pin_b</td><td>GPIO number for rotary encoder output B. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="a87cbd3ea0a9ad3294d33a3fb21000e58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_enable_half_steps </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable half-stepping mode. This generates twice as many counted steps per rotation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">enable</td><td>If true, count half steps. If false, only count full steps. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="a845c5991d014cd4061f24b967c97c4b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_flip_direction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reverse (flip) the sense of the direction. Use this if clockwise/counterclockwise are not what you expect. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="aa181030c3edeb8ea430dc366ee009e99"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_uninit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the interrupt handlers installed by <a class="el" href="rotary__encoder_8h.html#a1ab022382cc11d8c166530edd3c1b258" title="Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called. ">rotary_encoder_init</a>. Note: GPIOs will be left in the state they were configured by <a class="el" href="rotary__encoder_8h.html#a1ab022382cc11d8c166530edd3c1b258" title="Initialise the rotary encoder device with the specified GPIO pins and full step increments. This function will set up the GPIOs as needed, Note: this function assumes that gpio_install_isr_service(0) has already been called. ">rotary_encoder_init</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="aedafea81edf1547c3822bb3f6356159f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">QueueHandle_t rotary_encoder_create_queue </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a queue handle suitable for use as an event queue. </p>
<dl class="section return"><dt>Returns</dt><dd>A handle to a new queue suitable for use as an event queue. </dd></dl>

</div>
</div>
<a class="anchor" id="a04b593e8b7464f56bb61f707ec5ea3c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_set_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QueueHandle_t&#160;</td>
          <td class="paramname"><em>queue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the driver to use the specified queue as an event queue. It is recommended that a queue constructed by <a class="el" href="rotary__encoder_8h.html#aedafea81edf1547c3822bb3f6356159f" title="Create a queue handle suitable for use as an event queue. ">rotary_encoder_create_queue</a> is used. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">queue</td><td>Handle to queue suitable for use as an event queue. See <a class="el" href="rotary__encoder_8h.html#aedafea81edf1547c3822bb3f6356159f" title="Create a queue handle suitable for use as an event queue. ">rotary_encoder_create_queue</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="a0f098676e06b1500fc64d391c7931cb0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_get_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__state__t.html">rotary_encoder_state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current position of the rotary encoder. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>Pointer to an allocated <a class="el" href="structrotary__encoder__state__t.html" title="Struct represents the current state of the device in terms of incremental position and direction of l...">rotary_encoder_state_t</a> struct that will </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="ac7bdc0adf57d3e83b9e1d2222186ebc2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t rotary_encoder_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrotary__encoder__info__t.html">rotary_encoder_info_t</a> *&#160;</td>
          <td class="paramname"><em>info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the current position of the rotary encoder to zero. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>Pointer to initialised rotary encoder info structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK if successful, ESP_FAIL or ESP_ERR_* if an error occurred. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
